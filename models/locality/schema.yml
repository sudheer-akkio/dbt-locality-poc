
version: 2

sources:
  - name: locality_poc_share_gold
    database: locality-poc-share
    schema: gold
    tables:
      - name: freewheel_logs_gold
        description: Freewheel logs gold table (8.26B rows)

  - name: locality_poc_share_silver
    database: locality-poc-share
    schema: silver
    tables:
      - name: datonics_ids
        description: >
          This table consolidates all of the Datonics segment definitions
          across all of the various identifier types. (609B rows)
      - name: datonics_segments
        description: >
          This table provides information about the segments defined in the
          datonics_ids table. It was manually uploaded from a Datonics-provided
          Excel document, representing the small sample of segments for
          Locality to evaluate against FreeWheel. (1,191 segments)
      - name: deepsync_consolidated_id_map
        description: >
          Mapping table connecting DeepSync IDs and Household IDs to all types
          of identities, including IP addresses, MAIDs, and CTV IDs.
      - name: deepsync_consumer_attribute_silver
        description: >
          The table contains demographic and lifestyle information about individuals.
          It includes data like dwelling types, presence of children in various age
          groups, and interests such as reading, camping, and pet ownership.
          It contains processes for normalization, mapping, and data transformation.
      - name: experian_consolidated_id_map
        description: >
          The table contains information linking digital households to their
          corresponding offline households. It includes attributes such as unique
          identifiers for digital households, generalized identities like IP
          addresses or device IDs, and the type of identity used. This data can
          be useful for analyzing the relationship between digital and offline
          consumer behaviors, enhancing targeted marketing strategies, and
          improving customer segmentation. (7.9B rows)
      - name: experian_consumerview
        description: >
          The table contains data on various household types and their characteristics,
          particularly focusing on renters and homeowners. It includes information on
          demographics, living preferences, and estimated income ranges. Possible use
          cases include targeting marketing strategies for specific demographics,
          understanding rental market trends, and tailoring products and services to
          different household types. (288M rows, 528 columns)
      - name: freewheel_placement_mapping
        description: >
          Contains information about the CTV advertising campaigns managed by
          Locality in FreeWheel. It includes details such as the campaign and
          placement IDs, their corresponding names, advertiser category, and
          date ranges. This data can be used to track the performance of campaigns,
          analyze the effectiveness of different placement types, and compare the
          success of campaigns across different categories. This table joins to
          the Locality Logs table via the fw_placement_id column, which should
          match the PlacementId column in the FreeWheel log tables.
      - name: inscape_segments
        description: >
          Segments of the Inscape audience based on TV Viewing patterns or
          Ad Exposure (692M rows)
      - name: loopme
        description: >
          LoopMe provides performance-related data based on Locality's active
          campaigns. The combination of Mobile Advertising ID (MAID), IP address,
          and timestamp can be matched against Locality's FreeWheel log data to
          directly measure ad performance. (7.4M rows)

models:
  - name: akkio_attributes_latest
    description: >
      Household spine with decoded Experian behavioral attributes and spending patterns.
      Rows: 108M | Grain: AKKIO_ID | Refresh: Full (~1 min) | Materialization: Table
      | :short-name:audience_attributes: :use_for_audience_gen: |<
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - AKKIO_ID
    columns:
      - name: PARTITION_DATE
        description: "Current date when model was run | :akkio-context-ignore |<"
        tests:
          - not_null
      - name: AKKIO_ID
        description: "Unique household identifier | :ID"
        tests:
          - unique
          - not_null
      - name: LUID
        description: "Linked user ID from Experian (one per household via MIN)"
      - name: HOUSING_SEGMENT
        description: "Housing type segment (apartment renter types, homeowner types) | :Demographics :all_unique_values"
      - name: HOME_OWNERSHIP
        description: "Home ownership status (1=Owner, 0=Renter, NULL=Unknown)"
      - name: NET_WORTH_K
        description: "Net worth in thousands (lower bound of bucket) | :Demographics"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100000
              severity: warn
      - name: NET_WORTH_BUCKET
        description: "Net worth bucket code (1-9) | :Demographics"
      - name: HOUSEHOLD_INCOME_K
        description: "Estimated household income in thousands (lower bound) | :Demographics"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 5000
              severity: warn
      - name: INCOME_BUCKET
        description: "Income bucket code (1-7) | :Demographics"
      - name: HIGH_WEALTH_FLAG
        description: "High wealth indicator (5M+)"
      - name: EMPLOY_PUBLIC_COMPANY
        description: "Employed by public traded company flag"
      - name: EMPLOY_PRIVATE_COMPANY
        description: "Employed by private held company flag"
      - name: EXECUTIVE_DECISION_MAKER
        description: "Executive or decision maker flag"
      - name: COMPANY_FOUNDER
        description: "Company founder flag"
      - name: HIGH_VALUE_STOCK_HOLDER
        description: "Receives high value stock compensation flag"
      - name: HOME_SALE_PROPENSITY
        description: "Likelihood to sell home with timeframe | :all_unique_values"
      - name: DBT_UPDATED_AT
        description: "Timestamp when record was processed by dbt | :akkio-ml-ignore |<"

  - name: identity_to_akkio_deduped
    description: >
      Deduplicated identity graph for joins (MATERIALIZED TABLE).
      Rows: 1.76B | Refresh: Full (~5-10 min)
      CRITICAL: Must be table not view - referenced 3+ times in downstream models.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - IDENTITY
            - ID_TYPE
            - AKKIO_ID
    columns:
      - name: IDENTITY
        description: "The identity value (IP, MAID, CTV ID, etc)"
      - name: ID_TYPE
        description: "Type of identity | :lower"
      - name: AKKIO_ID
        description: "Associated household ID | :ID"

  - name: locality_campaign_exposure
    description: >
      Campaign impressions from FreeWheel enriched with LoopMe conversion data.
      Rows: 2.9B | Grain: (TRANSACTION_ID, AKKIO_ID) | Partition: EVENT_DATE (monthly)
      | :short-name:campaign_exposure: |<
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - TRANSACTION_ID
            - AKKIO_ID
    columns:
      - name: AKKIO_ID
        description: "Household identifier | :ID"
        tests:
          - not_null
          - relationships:
              to: ref('akkio_attributes_latest')
              field: AKKIO_ID
      - name: LOOPME_CAMPAIGN_ID
        description: "LoopMe campaign identifier (if conversion occurred)"
      - name: HAS_LOOPME_CONVERSION
        description: "Boolean flag indicating if household converted in LoopMe"
        tests:
          - not_null
      - name: TRANSACTION_ID
        description: "Unique FreeWheel transaction identifier"
        tests:
          - not_null
      - name: EVENT_DATE
        description: "Date of the ad exposure | :ui-name:Exposure Date:"
        tests:
          - not_null
      - name: LOCALITY_CAMPAIGN_ID
        description: "Locality campaign identifier | :ui-name:Campaign ID:"
      - name: LOCALITY_ADVERTISER
        description: "Locality advertiser name"
      - name: LOCALITY_CAMPAIGN
        description: "Locality campaign name"
      - name: IP_ADDRESS
        description: "IP address of the viewer"
      - name: DEVICE_ID
        description: "Device ID of the viewer"
      - name: CREATIVE_ID
        description: "Creative ID"
      - name: REVENUE
        description: "Revenue from impression"

  - name: akkio_segments
    description: >
      Household segment assignments from Inscape (TV viewing and ad exposure patterns).
      Rows: ~410M | Grain: (AKKIO_ID, SEGMENT_ID, SEGMENT_SOURCE)
      NOTE: Datonics segments skipped due to 609B row source table requiring specialized processing.
      | :short-name:audience_segments: |<
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - AKKIO_ID
            - SEGMENT_ID
            - SEGMENT_SOURCE
    columns:
      - name: AKKIO_ID
        description: "Household identifier | :ID"
        tests:
          - not_null
      - name: SEGMENT_ID
        description: "Segment identifier"
        tests:
          - not_null
      - name: SEGMENT_NAME
        description: "Normalized segment name | :lower :space-to-hyphen"
      - name: SEGMENT_DESCRIPTION
        description: "Segment description (Datonics only - currently NULL)"
      - name: SEGMENT_SOURCE
        description: "Source of the segment | :lower"
        tests:
          - accepted_values:
              values: ['inscape']
